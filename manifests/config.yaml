apiVersion: kots.io/v1beta1
kind: Config
metadata:
  name: cd4pe-config
spec:
  groups:
  - name: encryption_setup
    title: Database Encryption
    description: Secrets for configuring database encryption
    items:
    - name: pfi_secret_key
      title: PFI Secret Key
      description: |
        A base64-encoded 16-byte key; can be generated with 'dd bs=1 if=/dev/urandom count=16 2>/dev/null | base64'
      type: password
      required: true
       # Uses Sprig functions to generate a (mostly) random 16-byte key
      value: '{{repl randAscii 16 | b64enc}}'
  - name: environment_setup
    title: Environment Setup
    description: Setup where the application runs and how it's exposed to the internet
    items:
    - name: namespace
      title: Kubernetes Namespace
      description: |
        The namespace to deploy in.
      type: text
      value: cd4pe
    - name: enable_ingress
      type: bool
      title: Enable Kubernetes Ingress
      description: |
        Uncheck this box to disable the Kubernetes Ingress resource.
      default: "1"
    - name: hostname
      type: text
      title: Hostname
      description: |
        Use this field to provide a hostname for your Example Application installation.
      required: true
      when: repl{{ ConfigOptionEquals "enable_ingress" "1" }}
    - name: allow_http
      type: bool
      title: Allow Unsecured Access through HTTP
      description: |
        Uncheck this box to disable HTTP traffic between the client and the load balancer.
      default: "1"
      when: repl{{ ConfigOptionEquals "enable_ingress" "1" }}
    - name: annotations
      type: textarea
      title: Annotations
      description: |
        Use this textarea to provide annotations specific to your ingress controller.
        For example, `kubernetes.io/ingress.class: alb` when using the ALB ingress controller.
      when: repl{{ ConfigOptionEquals "enable_ingress" "1" }}
